#!/usr/bin/env bash

h=/home/aghost-7

run-dev() {
	slipway start -e GH_TOKEN -e GH_PASS -e GH_USER --pull aghost7/$1:$2
}

run-db() {
	if [ "$(docker ps | awk "\$2 ~ /$1/ { print \$1 }")" == "" ]; then
		docker run --rm --name "$1" "aghost7/$1:$2"
		exit 0
	fi
	docker exec -ti "$1" bash
}

case "$1" in
	devops)
		run-dev devops bionic
		;;
	c)
		run-dev c-dev bionic
		;;
	ruby)
		run-dev ruby-dev bionic
		;;
	py)
		run-dev py-dev bionic
		;;
	rust)
		run-dev rust-dev bionic-nightly
		;;
	node)
		run-dev nodejs-dev bionic-dubnium
		;;
	java)
		run-dev java-dev bionic
		;;
	go)
		run-dev go-dev 1.6
		;;
	cljs)
		run-dev cljs-dev latest
		;;
	pg)
		run-db pg-dev 9.3
		;;
	my)
		run-db my-dev 5.6
		;;
	*)
		echo Bad argument \"$1\"
		exit 1
		;;
esac
